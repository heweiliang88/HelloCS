---
title: 跨域
categories:
- 前端
tags:
- 跨域
abbrlink: 47908
---


[前端常见跨域解决方案（全） - SegmentFault 思否](https://segmentfault.com/a/1190000011145364)

[九种跨域方式实现原理（完整版）](https://juejin.cn/post/6844903767226351623)

[你再不知道怎么解决跨域,我就真的生气了](https://juejin.cn/post/6844904080163209223)

[正确面对跨域，别慌](https://juejin.cn/post/6844903521163182088)

[跨域](https://juejin.cn/post/6844903496521613320)



# 跨域

非同源策略请求

同源策略请求 ajax / fetch

跨域传输 

服务器拆分
web服务器：静态资源   web.com
data 服务器：业务逻辑和数据分析 data.com
图片服务器： phote.com
三者都一样就是同源，只要一个不同就是跨域
协议
域名
端口
JSONP 跨域解决 方案的底层原理
个是两组服务器配上相同的域名。还有就是自己的服务器 nginx 上做一个转发。

#  jsonp 
（JSON with Padding）
> 浏览器同源策略：
JSONP (JSON with Padding) 是 json 的一种 `使用模式`，可以让网页从别的域名（网站）那获取资料，即跨域读取数据。
[说说 JSONP 和 XSS](https://blog.cyeam.com/json/2017/10/27/jsonp-xss)
- script
- img
- link
- iframe:以上的标签不存在跨域请求的限制 问题：JSONP 只能处理GET 请求
## JSONP 代码实现方式
原理：就是目标页面回调本地页面的方法，并带入参数
![image-20200808164017049](https://i.loli.net/2020/08/08/o5Z2WIHn4UBES8V.png)
## JS原生实现 JSONP
> 通过`script ` 导入
```html
<div id="divCustomers"></div>
<script type="text/javascript">
function callbackFunction(result, methodName)
{
    var html = '<ul>';
    for(var i = 0; i < result.length; i++)
    {
        html += '<li>' + result[i] + '</li>';
    }
    html += '</ul>';
    document.getElementById('divCustomers').innerHTML = html;
}
</script>
<script type="text/javascript" src="https://www.runoob.com/try/ajax/jsonp.php?jsoncallback=callbackFunction"></script>
```
## JQuery 实现 JSONP
### 例子一
客户端
index.html
```html
<script src=“jquery.min.js”>
<script src="./index.js">
```
index.js
```js
 $.ajax({
 	url:'http://127.0.0.1:8081/list',
 	methods:'get',
 	dataType:'jsonp', // => 执行的是jsonp 的请求
 	success:res =>{
 		console.log(res)
 	}
 });
```
服务器 express
```js
let express = require('express')
	app = express();
app.listen(8081,()=>{
	console.log('OK');
});	
app.get('/list',(req,res) => {
	let { callback = Function.prototype } = req.query;
	let data = { code:0, message:'hello'  };
	res.send(`${callback}(${JSON.stringify(data)})`);
});
```
### 例子二
```js
<script src=“jquery.min.js”>
<script>
	$.getJSON("https://www.runoob.com/try/ajax/jsonp.php?jsoncallback=?", function(data) {
    var html = '<ul>';
    for(var i = 0; i < data.length; i++)
    {
        html += '<li>' + data[i] + '</li>';
    }
    html += '</ul>';
    $('#divCustomers').html(html); 
});
</script>
```
# cors

跨域资源共享
客户端 发送 ajax /fetch 请求

```js
// 导入文件 axios 的js 文件
axios 发送AJAX 请求
axios.get('http://127.0.0.1:8080/user/list').then(result=>{
	console.log(result)
})
axios .defaults. baseURL =' http://127.0.0.1:8888'; axios. defaults. withCredentials = true; axios . defaults . headers [ ' Content-Type'] = ' application/
X-WWW-form-urlencoded ' ; axios . defaults . transformRequest = function (data) {
if (! data) return data; let result =、; for (1et attr in data) {
if (! data. hasOwnProperty(attr)) break; result +=、 &${ attr}=${ data[ attr]}^ ; return result. substring(1); I
};
axios . interceptors. response. use(function onFulfilled(response)
return response . dataj
}, function onRejected(reason) {
return Promise. reject(reason);
}); axios . defaults . validateStatus = function (status) {
return /^(2|3)\d{2}$/. test(status);
```
服务器端 设置相关的头信息（需要处理options 试探性请求）
```js
app.use((req, res, next) => {
    res.header("Access -Control-Allow-Origin","http://localhost:8000");  // http: //localhost:8000 允许请求的url 地址  // =>*（就不能允许携带cookie） 具体地址
    res.header("Access-Control-Allow-Credentials", true); 
    res.header("Access-Control-Allow-Headers","Content-Type,Content-Length,Authorization, Accept ,X-Requested-With"); 
    res.header("Access-Control-Allow-Methods","PUT, POST, GET , DELETE , HEAD, OPTIONS"); 
    if (req.method === ' OPTIONS') {
        res. send('OK!'); return;
    }
    next();
});
```
# domain



# http proxy  
webpack webpack-dev-server
生产环境
修改webpack,config.js 文件
```bash
devServer:{
	port:3000,
	progress:true,
	contentBase:'./build',
	proxy:{
		'/':{
			target:'http://127.0.0.1:3001',
			changeOrigin:true
		}
	}
}
```
node 中间件代理
# nginx

反向代理
# postMessage
A.html
```bash
<iframe  id="iframe" src="http://127/0.0.1:1002/B.html" frameborder style="display:none"></iframe>
//console.log(iframe.contentWindow)
window.onload = function(){
	iframe.contentWindow.postMessage('asdfsd','http://127/0.0.1:1002')
}
// 监听从B 发送过来的信息
window.onmessage = function(ev){
	console.log(ev.data); 
}	
```
B.html
```bash
<script>
// 监听从A 发送过来的信息
window.onmessage = function(ev){
	console.log(ev.data);
	// ev.source:A
	ev.source.postMessage(ev.data +'@@@',*);
}	
</script>
```
# scoket.io
Websocker  协议跨域





# Chart.js

# D3

> [可视化工具D3.js教程 入门](http://www.hellojava.com/a/88290.html)
>
> [D3.js中文版api-接口文档](https://blog.mn886.net/chenjianhua/show/773c07b3abce/index.html)

D3.js是一个强大的数据可视化js语言，可以利用svg在网页上展示各种精美的矢量图

```
<script src="https://d3js.org/d3.v5.min.js"></script>
```

选择器

- d3.select()
- d3.selectAll()

```js
var h3 = d3.select("body").selectAll("h3");
var h4 = d3.select("h4");
var author = d3.select("[title='author']"); // 属性
var date = d3.select(".date"); // class
选择器.text('文本内容')
```

数据绑定

- datum() 绑定一个数据到选择集上  **是数据对应所有（多个）选择集元素；**
- data()：绑定一个数组到选择集上，数组的各项值分别与选择集的各元素绑定 **数据与选择集元素是一一对应关系；**

```js
var h3 = d3.selectAll('h3');
hd.datum('知识就是力量').text(function(v,i){
    return '第i个标签，内容是：' + v
})
第0个标签，内容是：知识就是力量
第1个标签，内容是：知识就是力量
第2个标签，内容是：知识就是力量
第3个标签，内容是：知识就是力量

var ly = [
    '1','2','3','4'
]

var h4 = d3.selectAll('h4');
h4.data('知识就是力量').text(function (v, i) {
    return '第' + i + '个标签，内容是：' + v
})
h4.data(ly).text(function(v,i){
     return '第' + i + '个标签，内容是：' + v
})
第0个标签，内容是：知
第1个标签，内容是：识
第2个标签，内容是：就
第3个标签，内容是：是
第4个标签，内容是：力
第5个标签，内容是：量
```

- Update 更新元素节点（绑定数据时默认进行的）
- Enter 增加元素节点（这个的后面会用的很多）
- Exit 删除元素节点

选择、插入、删除

- d3.select()、d3.selectAll()

元素操作

- **修改元素内容**

	selection.text([value])

	selection.html([value])

```

```



- **修改元素属性值**

**添加、移除元素 calss方法**

**插入元素**

- append()：在选择集尾部插入元素
- insert()：在选择集前面插入元素



```
var updata = h3.data(ly);
var enter = updata.enter();

var addH3 = enter.append('h3'); // 往enter中插入h3
console.log(enter)

 var  updata = h3.data(ly);
 var  exit = updata.exit();
```

图表

```js
<svg width="100%" height="300">

var data =[12,78,34,45,56]
var g = d3.select('svg') // 获取svg
		 .append('g') // 创建分组
         .attr('transform','translate(30,30)'); // 图表距离视口的左、上距离
var reactHeight = 30 //设定矩形的高＋与下一个矩形的边距  共30px
g.selectAll('rect')
    .data(data)
    .enter()
    .append('rect')//利用enter 创建与数据个数一样的rect矩形
    .attr('x',0)//这里设定矩形左上顶点的x值
    .attr('y',function (d,i) {
    return rectHeight*i;//这里设定矩形左上顶点的Y值
})
    .attr('width',function (d,i) {
    return d;//矩形宽度
})
    .attr('height',rectHeight - 5)//这里矩形实际的高度就是25  与下一个矩形的边距是5
    .style('fill','pink');//填充色
```



